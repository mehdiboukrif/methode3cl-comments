<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commentaires</title>
    <style>
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #fff;
        }
        #comments-container { min-height: 400px; }
    </style>
</head>
<body>
    <div id="comments-container">Chargement des commentaires...</div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const pageUrl = urlParams.get('url') || window.parent.location.href;
        
        function toPageId(url) {
            let encoded = btoa(unescape(encodeURIComponent(url)))
                .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
            return encoded.substring(0, 50);
        }
        
        const pageId = toPageId(pageUrl);
        console.log('üÜî Page ID:', pageId);
        
        // Version alternative : charger Hyvor via innerHTML au lieu d'import
        const container = document.getElementById('comments-container');
        container.innerHTML = `
            <div data-hyvor-talk-id="11990" data-hyvor-talk-page-id="${pageId}"></div>
        `;
        
        // Charger le script Hyvor de mani√®re synchrone
        const script = document.createElement('script');
        script.src = 'https://talk.hyvor.com/embed/embed.js';
        script.type = 'text/javascript';  // Pas de module
        script.onload = () => {
            console.log('‚úÖ Hyvor charg√© avec succ√®s');
            adjustIframeHeight();
        };
        script.onerror = () => console.error('‚ùå Erreur chargement Hyvor');
        document.head.appendChild(script);
        
        // Redimensionnement
        function adjustIframeHeight() {
            const height = Math.max(document.body.scrollHeight, 500);
            window.parent.postMessage({ type: 'resize', height }, '*');
        }
        
        // Observer les changements pour le redimensionnement
        const observer = new MutationObserver(adjustIframeHeight);
        observer.observe(container, { childList: true, subtree: true });
        
        setTimeout(adjustIframeHeight, 3000);
        setInterval(adjustIframeHeight, 5000);
    </script>
</body>
</html>
