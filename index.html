<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commentaires</title>
    <style>
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #fff;
            min-height: 400px;
        }
        #comments-container { 
            min-height: 400px; 
            width: 100%;
        }
        hyvor-talk-comments {
            display: block;
            width: 100%;
            min-height: 300px;
        }
    </style>
</head>
<body>
    <div id="comments-container">
        <p>Chargement des commentaires...</p>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const pageUrl = urlParams.get('url') || window.parent.location.href;
        
        function toPageId(url) {
            let encoded = btoa(unescape(encodeURIComponent(url)))
                .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
            return encoded.substring(0, 50);
        }
        
        const pageId = toPageId(pageUrl);
        console.log('ðŸ†” Page ID utilisÃ©:', pageId);
        console.log('ðŸ”— URL originale:', pageUrl);
        
        // Nettoyer le container
        const container = document.getElementById('comments-container');
        container.innerHTML = '';
        
        // CrÃ©er l'Ã©lÃ©ment Hyvor Talk comme avant mais sans les imports problÃ©matiques
        const comments = document.createElement("hyvor-talk-comments");
        comments.setAttribute("website-id", "11990");
        comments.setAttribute('page-id', pageId);
        
        // Ajouter l'Ã©lÃ©ment
        container.appendChild(comments);
        console.log('âœ… Ã‰lÃ©ment hyvor-talk-comments crÃ©Ã©');
        
        // Charger le script SANS type="module" pour Ã©viter les erreurs d'import
        const script = document.createElement('script');
        script.src = 'https://talk.hyvor.com/embed/embed.js';
        script.async = true;
        
        script.onload = () => {
            console.log('âœ… Script Hyvor chargÃ© avec succÃ¨s');
            setTimeout(adjustIframeHeight, 2000);
        };
        
        script.onerror = () => {
            console.error('âŒ Erreur lors du chargement du script Hyvor');
        };
        
        document.head.appendChild(script);
        
        // Fonctions de redimensionnement
        function adjustIframeHeight() {
            const height = Math.max(document.body.scrollHeight, 500);
            console.log('ðŸ“ Ajustement hauteur:', height);
            window.parent.postMessage({
                type: 'resize',
                height: height
            }, '*');
        }
        
        // Observer les changements dans le container
        const resizeObserver = new ResizeObserver(() => {
            adjustIframeHeight();
        });
        resizeObserver.observe(document.body);
        
        // Redimensionnements pÃ©riodiques
        setTimeout(adjustIframeHeight, 1500);
        setTimeout(adjustIframeHeight, 3000);
        setTimeout(adjustIframeHeight, 5000);
        
        setInterval(adjustIframeHeight, 10000);
        
        // Ã‰couter les Ã©vÃ©nements de chargement de Hyvor
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'hyvor-talk-loaded') {
                console.log('ðŸŽ‰ Hyvor Talk chargÃ© et prÃªt');
                adjustIframeHeight();
            }
        });
        
        console.log('ðŸŽ¯ Script d\'initialisation terminÃ©');
    </script>
</body>
</html>
